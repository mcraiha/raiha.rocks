Title: S3 ja staattisten sivujen jakelu eteenp√§in
Tags: 
  - AWS
  - S3
  - staattiset sivut
---
## Yleist√§ l√∂pin√§√§
[Edellisess√§ blogi-kirjoituksessa](/posts/Osa_yksi_cloudflare.html) k√§vin l√§pi lyhyesti CloudFlaren k√§ytt√∂√∂nottoa CDN:n osalta, ja t√§ll√§ kertaa vuorossa on [Amazonin S3](https://aws.amazon.com/s3/).

S3 on lyhenne sanoista **Simple Storage Service**, ja se on Amazonin pilvipalvelu tiedostojen s√§il√∂miseen. S3 on hyv√§ alusta esim. varmuuskopioiden tallentamiseen ja kuvatiedostojen jakeluun, mutta t√§ss√§ tapauksessa k√§yt√§n S3:sta vain yksinkertaisena HTTP-palvelimena.

S3:ssa tiedostoja tallennetaan bucketeihin (huono suomennos olisi saavi tai √§mp√§ri), ja jokaiselle bucketille voidaan m√§√§ritt√§√§ omat asetukset esim. k√§ytt√∂oikeuksien ja k√§yt√∂ss√§ olevien ominaisuuksien osalta.

Tiedostojen siirt√§minen buckettiin onnistuu vaikkapa selaimella suoraan AWS Consolen kautta. Suurten tiedostom√§√§rien kanssa kannattaa k√§ytt√§√§ kuitenkin parempia ty√∂kaluja, ja itsell√§ni k√§yt√∂ss√§ on graafinen [Cyberduck](https://cyberduck.io/)-ohjelma.

## Asetukset

P√§hkin√§nkuoressa homma menee seuraavasti: 

- Luodaan [ilmainen AWS-tili](https://aws.amazon.com/free/), jos sellaista ei viel√§ ole. Ilmaisessa tiliss√§ S3-tallennustilaa saa 5 gigatavua, joka riitt√§√§ erinomaisesti blogisis√§ll√∂lle. Tilin luominen vaatii luottokortin.

- [Luodaan uusi S3 bucket](https://docs.aws.amazon.com/AmazonS3/latest/user-guide/create-bucket.html), joka nimet√§√§n samalla nimell√§ kuin halutun blogin osoite, t√§ss√§ tapauksessa siis *mc.raiha.rocks*. Regionilla ei CDN-palvelujen kanssa k√§ytettyn√§ ole niin paljon v√§li√§, mutta ilman niit√§ bucket kannattaa sijoittaa sille regionille, joka on l√§hinn√§ sit√§ paikkaa, josta kohdistuu eniten liikennett√§ buckettiin.

![Bucketin nimi](../images/s3_asetus_01.png)

- Kun bucket on luotu, tehd√§√§n siit√§ HTTP-yhteydell√§ saavutettava menem√§ll√§ kyseisen bucketin **Properties** -osioon, josta valitaan **Static website hosting** -kohta. Aukeavasta ikkunasta valitaan *Use this bucket to host a website* -valinta ja annetaan nimet sek√§ *Index*- ett√§ *Error*-dokumenteille. **Save**-nappia painamalla asetukset astuvat voimaan. Kyseisest√§ ikkunasta kannattaa kopioida talteen **Endpoint**-osoite, joka kopioidaan my√∂hemmin CloudFlaren DNS-asetuksiin.

![Bucketin properties](../images/s3_asetus_02.png)

![Static web hosting -asetukset](../images/s3_asetus_03.png)

- Viimeiseksi [annetaan kaikille oikeus](https://docs.aws.amazon.com/AmazonS3/latest/dev/HostingWebsiteOnS3Setup.html) poimia bucketista yksitt√§isi√§ tiedostoja (jotta selain saa tiedostoja ladattua bucketista). T√§m√§ tapahtuu **Permissions** -kohdan alla olevasta **Bucket Policy** -osiosta, jonne laitetaan seuraavanlainen teksti

```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "PublicReadGetObject",
            "Effect": "Allow",
            "Principal": "*",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::BUCKETIN_NIMI_T√ÑH√ÑN/*"
        }
    ]
}
```

![Bucket Policy -asetukset](../images/s3_asetus_04.png)

## Lopputekstit

T√§ss√§ vaiheessa kannattaa buckettiin siirt√§√§ *index.html*-tiedosto, ja kokeilla ett√§ aiemmin kopioitu Endpoint-osoite aukeaa selaimessa. Tiedoston voi siirt√§√§ S3:een esim. selaimella **Overview**-osion **Upload**-napin kautta avautuvalla ty√∂kalulla

![S3 upload](../images/s3_upload.png)

Jos osoite toimii selaimessa, voi kyseisen osoitteen ottaa k√§ytt√∂√∂n CloudFlaren kanssa.

üëç

